# Google Drive連携方式のセキュリティリスク分析

## 概要

本ドキュメントでは、Google Drive連携の3つの方式について、セキュリティリスクを包括的に洗い出します。

### 対象方式

1. **Google Form方式** - 顧客がGoogle Formを通じてPDFをアップロード
2. **顧客側GAS設定方式** - 顧客が自身の環境でGASを設定・運用
3. **社内GAS管理方式** - 弊社が一元的にGASを管理し、複数顧客のフォルダを監視

---

## 1. Google Form方式のセキュリティリスク

### 1.1 認証・認可リスク

- **フォームの不正送信**（影響度：高）
  - 公開フォームの場合、誰でもファイルを送信可能
- **provider_idの偽装**（影響度：中）
  - 悪意あるユーザーがprovider_idを推測して送信
- **フォームURLの漏洩**（影響度：中）
  - URLが漏洩すると不正送信のリスク

### 1.2 データ漏洩リスク

- **サービスアカウントへの権限付与**（影響度：中）
  - 全アップロードファイルにサービスアカウントがアクセス可能
- **Google Drive上のファイル残存**（影響度：低）
  - 処理後もDriveにファイルが残る場合、アクセス権が残存

### 1.3 可用性・運用リスク

- **DoS攻撃**（影響度：中）
  - 大量のフォーム送信でシステムを過負荷にできる
- **不正なファイル形式**（影響度：中）
  - PDF以外のファイルやマルウェアが送信される可能性
- **GASの実行制限**（影響度：低）
  - Google Apps Scriptの実行時間・回数制限に達する可能性

### 1.4 方式固有リスク

- **フォームの改ざん**（影響度：中）
  - 顧客がフォームの設定を変更
- **添付ファイルサイズ制限**（影響度：中）
  - Google Formの添付ファイル上限（10MB）
- **フォーム回答の漏洩**（影響度：中）
  - フォーム回答データへの不正アクセス
- **フォームのスパム**（影響度：中）
  - ボットによる大量の無効送信
- **複数回送信**（影響度：低）
  - 同じファイルを何度も送信される

### 1.5 顧客管理に起因するリスク

#### GAS・フォーム更新関連リスク

- **GASランタイムのアップデート**（影響度：高）
  - Google Apps Scriptのランタイム更新で顧客のGASが動作しなくなる
- **event-listenerのAPI変更**（影響度：**高**）
  - ペイロード形式変更時に顧客のGASを更新できない
- **顧客がGASを更新しない**（影響度：中）
  - セキュリティ修正や機能追加が適用されない
- **顧客にGAS更新を依頼する運用コスト**（影響度：中）
  - 全顧客に連絡・対応確認が必要
- **GAS更新の適用確認困難**（影響度：中）
  - 顧客が本当に更新したか確認できない
- **顧客ごとに異なるGASバージョンが稼働**（影響度：中）
  - サポート対象バージョンの管理が困難

#### フォーム管理リスク

- **顧客がフォームを削除**（影響度：高）
  - 処理が完全に停止する
- **顧客がフォームの質問を変更**（影響度：中）
  - GASが期待するフィールドがなくなる
- **顧客がフォームの共有設定を変更**（影響度：中）
  - 社内ユーザーが使えなくなる
- **フォームの回答先スプレッドシート変更**（影響度：中）
  - データの整合性が崩れる
- **顧客がトリガーを誤って削除**（影響度：中）
  - GASが動作しなくなる

#### 顧客環境依存リスク

- **顧客のGoogle Workspace管理者によるGAS無効化**（影響度：高）
  - 組織ポリシーでGAS実行が禁止される
- **顧客のGoogle Workspaceプラン変更**（影響度：中）
  - 無料プランへのダウングレードで機能制限
- **顧客ドメインのGoogle Workspace解約**（影響度：**高**）
  - フォーム・GASが全て削除される
- **顧客の担当者退職**（影響度：**高**）
  - GAS管理者不在で更新・対応不可
- **顧客側のGAS実行権限変更**（影響度：中）
  - 特定ユーザーのみ実行可能になる

---

## 2. 顧客側GAS設定方式のセキュリティリスク

### 2.1 認証・認可リスク

- **サービスアカウント情報の漏洩**（影響度：中）
  - 顧客のGASにサービスアカウントメールが記載されている
- **EVENT_LISTENER_URLの漏洩**（影響度：中）
  - エンドポイントURLが顧客に公開される
- **PROVIDER_IDの漏洩**（影響度：中）
  - 顧客のGASにPROVIDER_IDが記載されている
- **顧客によるGAS改ざん**（影響度：中）
  - 顧客がスクリプトを改変して不正なリクエストを送信

### 2.2 データ漏洩リスク

- **ファイルオーナーのメールアドレス取得**（影響度：低）
  - GASがファイルオーナーのメールを取得・送信
- **他顧客のprovider_idを使用**（影響度：高）
  - 顧客が他社のprovider_idを設定して送信
- **サービスアカウントへの過剰な権限付与**（影響度：中）
  - 顧客が意図せず機密ファイルに権限を付与

### 2.3 可用性・運用リスク

- **顧客のGAS設定ミス**（影響度：中）
  - フォルダIDの誤設定で処理失敗
- **顧客環境のGAS停止**（影響度：中）
  - 顧客がトリガーを削除・無効化
- **スクリプトのバージョン管理困難**（影響度：中）
  - 顧客ごとに異なるバージョンが稼働する可能性
- **大量ファイルによるレート制限**（影響度：中）
  - 顧客が大量ファイルを一度に配置してAPI制限に達する

### 2.4 コンプライアンスリスク

- **GASスクリプトの監査困難**（影響度：中）
  - 顧客環境で何が実行されているか把握困難
- **ログの管理困難**（影響度：中）
  - 顧客環境のGASログにアクセスできない

### 2.5 方式固有リスク

- **顧客によるスクリプト流出**（影響度：中）
  - 他社にスクリプトを共有される
- **顧客環境の制約**（影響度：中）
  - 顧客のGoogle Workspaceポリシーで実行不可
- **古いバージョンの使用継続**（影響度：中）
  - セキュリティ修正が適用されない
- **顧客独自カスタマイズ**（影響度：中）
  - サポート困難な改変を行われる
- **顧客のGAS知識不足**（影響度：中）
  - 設定ミスによる問題

### 2.6 顧客管理に起因するリスク

#### GAS更新関連リスク

- **GASランタイムのアップデート**（影響度：高）
  - V8ランタイム等の変更で動作しなくなる
- **event-listenerのAPI変更**（影響度：**高**）
  - エンドポイントURL変更時に全顧客のGASを更新必要
- **event-listenerのペイロード形式変更**（影響度：**高**）
  - 必須フィールド追加時に顧客のGASが動作しなくなる
- **認証方式の変更**（影響度：**高**）
  - API認証を追加した場合、顧客のGASが認証エラー
- **顧客がGASを更新しない・できない**（影響度：**高**）
  - 技術的知識がなく更新できない
- **更新手順の伝達ミス**（影響度：中）
  - 顧客が誤った更新を適用
- **更新後の動作確認不足**（影響度：中）
  - 顧客が更新後にテストせず本番で問題発覚

#### 顧客のGAS運用リスク

- **顧客がGASプロジェクトを削除**（影響度：**高**）
  - 処理が完全に停止、復旧困難
- **顧客がトリガーを削除**（影響度：中）
  - 自動処理が停止
- **顧客がスクリプトを誤編集**（影響度：中）
  - 構文エラーで動作しなくなる
- **顧客が設定値を誤変更**（影響度：高）
  - provider_id等を誤って変更
- **顧客のGAS実行権限の失効**（影響度：中）
  - OAuth同意の期限切れ
- **顧客がGASのログを確認しない**（影響度：中）
  - エラーが発生しても気づかない

#### サポート・コミュニケーションリスク

- **顧客からの問い合わせ対応コスト**（影響度：中）
  - GAS関連の問い合わせが増加
- **顧客環境へのアクセス不可**（影響度：中）
  - デバッグのために顧客環境を見られない
- **顧客の技術レベルのばらつき**（影響度：中）
  - 説明・サポートの難易度が顧客により異なる
- **顧客との認識齟齬**（影響度：中）
  - 「動かない」の原因特定が困難
- **障害切り分けの困難さ**（影響度：中）
  - 顧客のGAS問題か、弊社システム問題か判断困難

#### 顧客組織変更リスク

- **顧客の担当者退職・異動**（影響度：**高**）
  - GAS管理の引き継ぎがされない
- **顧客のIT部門方針変更**（影響度：高）
  - 外部連携スクリプトの禁止
- **顧客の合併・買収**（影響度：高）
  - Google Workspaceドメイン統合でGASが無効化
- **顧客のセキュリティ監査**（影響度：中）
  - 外部URL通信が問題視される

---

## 3. 社内GAS管理方式のセキュリティリスク

### 3.1 認証・認可リスク

- **GAS実行アカウントの権限集中**（影響度：**高**）
  - 1つのアカウントが全顧客のフォルダにアクセス
- **GAS実行アカウントの乗っ取り**（影響度：**高**）
  - 侵害されると全顧客のファイルにアクセス可能
- **サービスアカウントの権限集中**（影響度：**高**）
  - 全顧客のファイルをダウンロード可能

### 3.2 データ漏洩リスク

- **顧客間のデータ混同**（影響度：**高**）
  - CUSTOMERS設定ミスで別顧客のprovider_idを使用
- **顧客フォルダ内の意図しないファイル処理**（影響度：中）
  - 顧客が誤って機密ファイルをフォルダに配置
- **全顧客設定の一括漏洩**（影響度：**高**）
  - GASスクリプトが漏洩すると全顧客のフォルダIDが漏洩

### 3.3 データ破壊・喪失リスク

- **顧客ファイルの誤削除**（影響度：**高**）
  - `file.setTrashed(true)`などの誤実装でファイル削除
- **ファイルの移動先誤り**（影響度：**高**）
  - destination_folder_id設定ミスで別顧客のフォルダに移動
- **ファイルの上書き**（影響度：中）
  - 同名ファイルが存在する場合の挙動が不明確
- **処理済みフォルダの肥大化**（影響度：低）
  - 古いファイルが蓄積し続ける
- **GASの誤動作による大量処理**（影響度：中）
  - バグで同じファイルを何度も処理

### 3.4 可用性・運用リスク

- **単一障害点**（影響度：**高**）
  - GASが停止すると全顧客の処理が停止
- **GAS実行時間制限**（影響度：中）
  - 顧客数増加で6分の実行制限に達する可能性
- **トリガー数制限**（影響度：低）
  - Google Apps Scriptのトリガー数上限（20個）
- **顧客フォルダの共有解除**（影響度：中）
  - 顧客が共有を解除すると処理失敗

### 3.5 コンプライアンス・法的リスク

- **顧客データへの過剰アクセス権**（影響度：**高**）
  - 編集者権限で顧客のファイルを変更・削除可能
- **アクセスログの不透明性**（影響度：中）
  - 顧客側でアクセス履歴を確認しにくい
- **データ処理の同意**（影響度：中）
  - 顧客ファイルへのアクセスに関する契約・同意の必要性
- **インシデント時の責任範囲**（影響度：**高**）
  - ファイル消失時の責任の所在

### 3.6 方式固有リスク

- **顧客Aのファイルを顧客Bのフォルダに移動**（影響度：**高**）
  - 設定ミスによるデータ混同
- **顧客の共有フォルダ内の他ファイルへのアクセス**（影響度：中）
  - 処理対象外ファイルも閲覧可能
- **顧客が共有を解除して復旧要請**（影響度：中）
  - 処理済みファイルにアクセスできなくなる
- **GAS実行アカウントの2FA無効**（影響度：**高**）
  - アカウント乗っ取りリスク増大
- **顧客フォルダの意図しないサブフォルダ処理**（影響度：低）
  - 再帰的処理でサブフォルダも処理される（現在は未実装だが将来のリスク）
- **処理順序の公平性**（影響度：低）
  - CUSTOMERS配列の順序で処理優先度が決まる

### 3.7 弊社管理に起因するリスク

#### 弊社側の更新・メンテナンスリスク

- **GASランタイムのアップデート**（影響度：中）
  - 弊社で即座に対応可能だが、影響は全顧客に及ぶ
- **event-listenerのAPI変更**（影響度：中）
  - 弊社でGASを更新すれば済むが、更新漏れリスク
- **弊社担当者の不在**（影響度：高）
  - 担当者休暇・退職時に対応できない
- **GAS更新時の全顧客影響**（影響度：**高**）
  - 1つの変更ミスが全顧客に影響
- **テスト不足のまま本番適用**（影響度：**高**）
  - 全顧客に問題が波及

#### 弊社のGAS運用リスク

- **弊社のGoogle Workspaceアカウント停止**（影響度：**高**）
  - 全顧客の処理が停止
- **弊社のGAS実行アカウントの認証期限切れ**（影響度：**高**）
  - 全顧客の処理が停止
- **弊社の支払い滞納によるアカウント停止**（影響度：**高**）
  - Google Workspaceが利用不可
- **弊社内でのアカウント共有による混乱**（影響度：中）
  - 複数人が同時に編集して競合

---

## 4. 全方式共通リスク

### 4.1 技術的リスク

#### API・サービス依存リスク

- **Google API仕様変更**（影響度：高）
  - Drive API、Apps Script APIの仕様変更で動作しなくなる
- **Google APIの廃止**（影響度：高）
  - 使用しているAPIが非推奨・廃止になる
- **Google Apps Scriptの制限強化**（影響度：中）
  - 実行時間、クォータ、トリガー数の制限が厳しくなる
- **event-listenerのダウンタイム**（影響度：中）
  - メンテナンスや障害でGASからのリクエストが失敗
- **SSL/TLS証明書の期限切れ**（影響度：中）
  - HTTPS通信が失敗
- **Google OAuth認証の期限切れ**（影響度：中）
  - サービスアカウントの認証情報が無効化

#### ネットワーク・通信リスク

- **GASからevent-listenerへの通信傍受**（影響度：中）
  - 中間者攻撃でペイロードを盗聴される
- **DNS偽装**（影響度：高）
  - event-listenerのURLが偽サイトに誘導される
- **GASの外部通信制限**（影響度：中）
  - 企業のGoogle Workspaceポリシーで外部URLへの通信がブロック
- **IPアドレス制限**（影響度：中）
  - event-listener側でIP制限している場合、GASのIPが変動して遮断
- **タイムアウト**（影響度：中）
  - 大きなファイル処理でHTTPリクエストがタイムアウト

#### データ整合性リスク

- **二重処理**（影響度：中）
  - 同一ファイルが複数回処理される（トリガー重複実行）
- **処理の途中失敗**（影響度：中）
  - event-listener送信成功後、ファイル移動前にGASがクラッシュ
- **非原子的操作**（影響度：中）
  - 権限付与→送信→移動の途中で失敗した場合の不整合
- **ファイル名の文字化け**（影響度：低）
  - 日本語ファイル名がエンコーディング問題で化ける
- **ファイルIDの重複**（影響度：低）
  - Google Driveで同一ファイルIDが再利用される可能性（極めて低い）
- **MIME type偽装**（影響度：中）
  - PDFに見せかけた悪意あるファイル

#### 同時実行・競合リスク

- **同時トリガー実行**（影響度：中）
  - 複数のトリガーが同時に実行され、同じファイルを処理
- **ファイルロック**（影響度：中）
  - 処理中に顧客がファイルを編集・削除
- **フォルダ構造変更**（影響度：中）
  - 処理中に顧客がフォルダを移動・削除
- **権限の競合**（影響度：低）
  - 処理中に顧客が権限を変更

### 4.2 運用・人的リスク

#### 設定ミスリスク

- **provider_idのコピペミス**（影響度：**高**）
  - 別顧客のprovider_idを設定
- **folder_idのコピペミス**（影響度：**高**）
  - 別顧客のフォルダを監視
- **email_domainの設定ミス**（影響度：中）
  - 認証エラーで処理失敗
- **enabled: trueの設定忘れ**（影響度：低）
  - 顧客の処理が開始されない
- **enabled: falseの設定忘れ**（影響度：中）
  - 解約顧客の処理が継続される
- **本番/開発環境の混同**（影響度：**高**）
  - 開発用URLを本番に設定、またはその逆
- **サービスアカウントの誤指定**（影響度：中）
  - 権限のないサービスアカウントを設定

#### 変更管理リスク

- **GASスクリプトのバージョン管理不足**（影響度：中）
  - 変更履歴が追跡できない
- **設定変更の承認プロセス欠如**（影響度：中）
  - 無断で設定変更される
- **ロールバック手順の欠如**（影響度：中）
  - 問題発生時に元に戻せない
- **テスト環境の欠如**（影響度：**高**）
  - 本番環境で直接テスト
- **ドキュメント未更新**（影響度：中）
  - 実装とドキュメントの乖離

#### 人的ミスリスク

- **トリガーの誤削除**（影響度：中）
  - setupTrigger()ではなくremoveTrigger()を実行
- **全顧客設定の誤削除**（影響度：**高**）
  - CUSTOMERS配列を空にして保存
- **デバッグコードの残存**（影響度：中）
  - Logger.logやconsole.logに機密情報を出力
- **ハードコーディング**（影響度：中）
  - テスト用の値が本番に残る
- **コメントアウトミス**（影響度：中）
  - 重要な処理がコメントアウトされたまま

#### 引き継ぎ・属人化リスク

- **担当者退職**（影響度：**高**）
  - GAS管理の知識が失われる
- **パスワード・認証情報の共有不足**（影響度：**高**）
  - GAS実行アカウントにアクセスできなくなる
- **運用手順の未文書化**（影響度：中）
  - 障害時の対応方法が不明
- **設定意図の不明確化**（影響度：中）
  - なぜその設定になっているか分からなくなる

### 4.3 ビジネス・契約リスク

#### 契約・法務リスク

- **顧客データへのアクセス同意欠如**（影響度：**高**）
  - 契約書でデータアクセスの同意を得ていない
- **データ処理委託契約の欠如**（影響度：**高**）
  - GDPRや個人情報保護法違反の可能性
- **SLA未定義**（影響度：中）
  - 処理遅延・障害時の責任範囲が不明確
- **免責事項の不足**（影響度：**高**）
  - ファイル消失時の賠償責任
- **守秘義務違反**（影響度：**高**）
  - 顧客ファイルの内容が漏洩
- **第三者提供**（影響度：中）
  - Google（サービスアカウント経由）へのデータ提供の同意

#### 顧客関係リスク

- **顧客の期待値とのギャップ**（影響度：中）
  - 処理速度や信頼性への過度な期待
- **顧客への説明責任**（影響度：中）
  - 障害発生時の説明・報告義務
- **顧客からの信頼喪失**（影響度：**高**）
  - インシデント発生時のレピュテーションダメージ
- **解約時のデータ処理**（影響度：中）
  - 解約顧客のデータをどう扱うか
- **顧客のセキュリティ監査要求**（影響度：中）
  - 顧客からの監査・レポート要求に対応できない

#### コスト・リソースリスク

- **想定外の運用コスト**（影響度：中）
  - 顧客数増加に伴う運用負荷増大
- **Google Workspace課金**（影響度：低）
  - GAS実行アカウントのライセンスコスト
- **障害対応コスト**（影響度：中）
  - インシデント対応の人件費
- **スケーラビリティ限界**（影響度：中）
  - 顧客数増加でGASの制限に達する

### 4.4 コンプライアンス・規制リスク

#### 個人情報保護リスク

- **個人情報の取り扱い**（影響度：**高**）
  - PDFに含まれる個人情報の処理
- **越境データ移転**（影響度：中）
  - Google Driveのデータセンター所在地
- **データ保持期間**（影響度：中）
  - 処理済みファイルの保持期間ポリシー
- **アクセスログの保持**（影響度：中）
  - 誰がいつどのファイルにアクセスしたか
- **データ削除要求への対応**（影響度：中）
  - GDPR「忘れられる権利」への対応

#### 業界規制リスク

- **金融規制**（影響度：**高**）
  - 金融機関顧客の場合、FISC等の規制
- **医療規制**（影響度：**高**）
  - 医療機関顧客の場合、HIPAAやガイドライン
- **政府調達規制**（影響度：**高**）
  - 公共機関顧客の場合のセキュリティ要件
- **ISO27001/SOC2要件**（影響度：中）
  - 認証取得・維持への影響

#### 監査・証跡リスク

- **監査証跡の不足**（影響度：中）
  - 処理履歴を証明できない
- **ログの改ざん可能性**（影響度：中）
  - GASのLogger.logは改ざん耐性がない
- **アクセス履歴の追跡困難**（影響度：中）
  - 誰がどのファイルを処理したか不明確
- **インシデント調査困難**（影響度：中）
  - 事後調査に必要な情報が残っていない

### 4.5 セキュリティ攻撃リスク

#### 外部攻撃リスク

- **event-listenerへのDoS攻撃**（影響度：中）
  - エンドポイントが公開されている場合
- **クレデンシャルスタッフィング**（影響度：高）
  - サービスアカウントや実行アカウントへの攻撃
- **フィッシング**（影響度：**高**）
  - GAS実行アカウントの認証情報詐取
- **サプライチェーン攻撃**（影響度：中）
  - 依存ライブラリやAPIの侵害
- **総当たり攻撃**（影響度：低）
  - provider_idやfolder_idの推測

#### 内部脅威リスク

- **内部者による不正アクセス**（影響度：**高**）
  - GAS管理者が顧客データを閲覧
- **内部者による設定改ざん**（影響度：**高**）
  - 悪意ある設定変更
- **退職者のアクセス権残存**（影響度：**高**）
  - 退職後もGASアカウントにアクセス可能
- **権限の過剰付与**（影響度：中）
  - 必要以上の人がGASにアクセス可能

#### マルウェア・悪意あるコンテンツリスク

- **マルウェア入りPDF**（影響度：中）
  - 悪意あるPDFがシステムに取り込まれる
- **PDFエクスプロイト**（影響度：中）
  - PDF処理時の脆弱性を悪用
- **巨大ファイル攻撃**（影響度：中）
  - 超大容量PDFでシステムリソースを枯渇
- **ZIP爆弾的PDF**（影響度：低）
  - 展開時に膨大なリソースを消費するPDF

### 4.6 災害・事業継続リスク

#### インフラ障害リスク

- **Googleサービス障害**（影響度：**高**）
  - Google Drive、Apps Script、APIの障害
- **AWSリージョン障害**（影響度：**高**）
  - event-listener、S3の障害
- **インターネット障害**（影響度：中）
  - 大規模なネットワーク障害
- **長期障害時のデータ蓄積**（影響度：中）
  - 障害中にフォルダにファイルが蓄積

#### 事業継続リスク

- **バックアップの欠如**（影響度：中）
  - GASスクリプトや設定のバックアップがない
- **復旧手順の未整備**（影響度：中）
  - 障害復旧の手順が文書化されていない
- **代替手段の欠如**（影響度：中）
  - GASが使えない場合の代替処理方法がない
- **BCP未対応**（影響度：中）
  - 災害時の事業継続計画に含まれていない

### 4.7 event-listener側の変更による影響

#### API・ペイロード変更リスク

- **エンドポイントURL変更**
  - 全GASの更新が必要
  - Google Form：顧客依存（困難） / 顧客側GAS：顧客依存（困難） / 社内GAS管理：弊社対応可能
- **ペイロード必須フィールド追加**
  - GAS側で新フィールドを送信必要
  - Google Form：顧客依存（困難） / 顧客側GAS：顧客依存（困難） / 社内GAS管理：弊社対応可能
- **ペイロード形式変更（JSONスキーマ）**
  - GAS側の送信形式変更が必要
  - Google Form：顧客依存（困難） / 顧客側GAS：顧客依存（困難） / 社内GAS管理：弊社対応可能
- **認証追加（APIキー等）**
  - GAS側で認証ヘッダー追加が必要
  - Google Form：顧客依存（困難） / 顧客側GAS：顧客依存（困難） / 社内GAS管理：弊社対応可能
- **レスポンス形式変更**
  - GAS側のエラーハンドリング変更が必要
  - Google Form：顧客依存 / 顧客側GAS：顧客依存 / 社内GAS管理：弊社対応可能
- **レート制限の追加・変更**
  - GAS側の送信頻度調整が必要
  - Google Form：顧客依存 / 顧客側GAS：顧客依存 / 社内GAS管理：弊社対応可能

#### 後方互換性リスク

- **後方互換性のないAPI変更**（影響度：**高**）
  - 古いGASが即座に動作しなくなる
- **廃止予定APIの告知不足**（影響度：高）
  - 顧客が気づかず廃止日を迎える
- **移行期間の不足**（影響度：高）
  - 顧客がGASを更新する時間がない
- **バージョニングの欠如**（影響度：中）
  - 古いAPIと新しいAPIを並行運用できない

### 4.8 Google側のサービス変更リスク

#### Google Apps Script変更リスク

- **GASのランタイム廃止**（影響度：**高**）
  - Rhinoランタイム廃止のような大規模変更
- **GASのAPI廃止・変更**（影響度：高）
  - DriveApp、UrlFetchApp等のAPI変更
- **GASの実行制限強化**（影響度：中）
  - 実行時間、クォータの制限が厳しくなる
- **GASのセキュリティ要件強化**（影響度：中）
  - OAuth同意画面の要件厳格化
- **GASの課金モデル変更**（影響度：中）
  - 無料枠の縮小や有料化

#### Google Drive API変更リスク

- **Drive API v3の廃止**（影響度：高）
  - 新バージョンへの移行が必要
- **権限付与APIの変更**（影響度：中）
  - addViewer等のメソッド変更
- **ファイル移動APIの変更**（影響度：中）
  - moveTo等のメソッド変更
- **MIMEタイプ判定の変更**（影響度：低）
  - getFilesByType等の動作変更

#### Google Forms変更リスク

- **フォームトリガーの仕様変更**（影響度：高）
  - onFormSubmitの動作変更
- **添付ファイル機能の変更**（影響度：中）
  - ファイルアップロードの制限変更
- **フォーム回答データ形式の変更**（影響度：中）
  - e.response等の形式変更

---

## 5. リスク比較サマリー

### 5.1 方式別リスク比較

| リスクカテゴリ | Google Form | 顧客側GAS | 社内GAS管理 |
|----------------|-------------|-----------|-------------|
| 不正アクセス | 中（フォーム公開） | 中（改ざん可能） | 高（権限集中） |
| データ漏洩 | 低 | 中 | **高** |
| データ破壊 | 低 | 低 | **高** |
| 顧客間データ混同 | 低 | 低 | **高** |
| 単一障害点 | 低 | 低 | **高** |
| 運用ミス影響範囲 | 単一顧客 | 単一顧客 | **全顧客** |
| 監査・追跡 | 中 | 困難 | 容易 |

### 5.2 カテゴリ別高リスク数

| カテゴリ | 高リスク数 | 主な懸念 |
|----------|------------|----------|
| 技術的リスク | 3 | API依存、通信傍受、DNS偽装 |
| 運用・人的リスク | 8 | 設定ミス、属人化、環境混同 |
| ビジネス・契約リスク | 5 | 同意欠如、免責不足、信頼喪失 |
| コンプライアンスリスク | 4 | 個人情報、業界規制 |
| セキュリティ攻撃リスク | 4 | フィッシング、内部脅威 |
| 災害・事業継続リスク | 2 | Google/AWS障害 |
| 方式固有リスク | 3 | データ混同、2FA無効 |

### 5.3 管理主体別の総合比較

| リスク項目 | Google Form（顧客管理） | 顧客側GAS（顧客管理） | 社内GAS管理（弊社管理） |
|------------|-------------------------|------------------------|--------------------------|
| event-listener変更時の対応 | **困難**（顧客依存） | **困難**（顧客依存） | 容易（弊社対応） |
| GASランタイム変更時の対応 | **困難**（顧客依存） | **困難**（顧客依存） | 容易（弊社対応） |
| 更新の確実性 | 低（顧客任せ） | 低（顧客任せ） | 高（弊社管理） |
| 更新の一貫性 | 低（バージョン混在） | 低（バージョン混在） | 高（統一バージョン） |
| 更新ミスの影響範囲 | 単一顧客 | 単一顧客 | **全顧客** |
| 顧客担当者退職時の影響 | **高** | **高** | なし |
| 弊社担当者退職時の影響 | 低 | 低 | **高** |
| 顧客へのサポートコスト | 高 | **高** | 低 |
| 障害切り分けの容易さ | 困難 | 困難 | 容易 |
| 顧客組織変更時の影響 | **高** | **高** | 低 |

---

## 6. 最重要リスク（全方式共通）

1. **GAS実行アカウントの侵害** - 全顧客データへのアクセスが可能に
2. **設定ミスによる顧客間データ混同** - provider_id、folder_idの誤設定
3. **契約・同意の欠如** - データアクセスの法的根拠不足
4. **内部者による不正** - 管理者権限の悪用
5. **障害時の事業継続** - Google/AWS障害時の代替手段なし

---

## 7. 緩和策の推奨

### 7.1 社内GAS管理方式の重大リスク緩和策

#### ファイル操作の安全対策

```javascript
// 移動前に確認を行う安全な実装例
function moveToDestination(file, destinationFolderId) {
  // 移動前に確認
  if (!file || !destinationFolderId) {
    throw new Error('Invalid file or destination');
  }

  // 移動先フォルダの存在確認
  const destFolder = DriveApp.getFolderById(destinationFolderId);
  if (!destFolder) {
    throw new Error('Destination folder not found');
  }

  // ファイル移動（削除はしない）
  file.moveTo(destFolder);
  Logger.log('ファイル移動完了: ' + file.getName());
}
```

#### 権限の最小化

| 現在 | 推奨 |
|------|------|
| 編集者権限 | 可能であれば閲覧者権限 + 別の移動方式 |
| 全顧客を1アカウントで管理 | 顧客グループごとにアカウント分離を検討 |

#### 監査・ログ強化

```javascript
// 全操作をログに記録
function logOperation(operation, customer, file, result) {
  const log = {
    timestamp: new Date().toISOString(),
    operation: operation,
    customer: customer.name,
    provider_id: customer.provider_id,
    file_id: file ? file.getId() : null,
    file_name: file ? file.getName() : null,
    result: result
  };
  Logger.log(JSON.stringify(log));
  // 外部ログサービスへの送信も検討
}
```

#### 設定変更の二重チェック

- CUSTOMERS設定変更時はレビュー必須
- 本番適用前にテスト環境で検証
- folder_idの設定ミスを防ぐバリデーション追加

#### インシデント対応計画

- ファイル誤削除時の復旧手順（Google Driveのゴミ箱から復元）
- 顧客への通知フロー
- 責任範囲の契約での明確化

---

## 8. 更新履歴

| 日付 | 更新内容 |
|------|----------|
| 2025-12-08 | 初版作成 |
| 2025-12-08 | 管理主体に起因するリスク（GAS更新、顧客組織変更、event-listener変更影響等）を追加 |
